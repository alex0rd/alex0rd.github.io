<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Unidbg补环境之补JNI环境 &#183; Owl</title>
<meta name=title content="Unidbg补环境之补JNI环境 &#183; Owl"><meta name=description content="My awesome website"><meta name=keywords content="笔记,Unidbg,"><link rel=canonical href=https://alex0rd.github.io/posts/2025m1d7h22m24s55/><link type=text/css rel=stylesheet href=/css/main.bundle.min.e27868ab1485f7ed7b06b122b4980bd38b19526eb8f7de885181204d28f04a0c47e9c334eff19a06c0278eb2ff8415b983a5d0fb80fd6b5680c926457cc61c57.css integrity="sha512-4nhoqxSF9+17BrEitJgL04sZUm64996IUYEgTSjwSgxH6cM07/GaBsAnjrL/hBW5g6XQ+4D9a1aAySZFfMYcVw=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.c178288131a2f1ad46910438db47ac5f7e1c48cf949e49f6dc3310c8ec9660e23fe505805eba4e2e73711335808500360d773a2b64322feb35df52856edca286.js integrity="sha512-wXgogTGi8a1GkQQ420esX34cSM+Unkn23DMQyOyWYOI/5QWAXrpOLnNxEzWAhQA2DXc6K2QyL+s131KFbtyihg==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://alex0rd.github.io/posts/2025m1d7h22m24s55/"><meta property="og:site_name" content="Owl"><meta property="og:title" content="Unidbg补环境之补JNI环境"><meta property="og:description" content="主要是对龙哥Unidbg教程学习的笔记
Unidbg 的基本使用（三）
Unidbg 的基本使用（四）
Unidbg 的基本使用（五）
Unidbg 的基本使用（六）
Unidbg 的基本使用（七）
Unidbg 的基本使用（八）
Unidbg 的基本使用（九）"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-07T22:24:55+08:00"><meta property="article:modified_time" content="2025-01-07T22:24:55+08:00"><meta property="article:tag" content="笔记"><meta property="article:tag" content="Unidbg"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unidbg补环境之补JNI环境"><meta name=twitter:description content="主要是对龙哥Unidbg教程学习的笔记
Unidbg 的基本使用（三）
Unidbg 的基本使用（四）
Unidbg 的基本使用（五）
Unidbg 的基本使用（六）
Unidbg 的基本使用（七）
Unidbg 的基本使用（八）
Unidbg 的基本使用（九）"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Unidbg补环境之补JNI环境","headline":"Unidbg补环境之补JNI环境","abstract":"\u003cblockquote\u003e\n\u003cp\u003e主要是对龙哥Unidbg教程学习的笔记\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/bmf8lm68ffvhrfu0?#QGrRF\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（三）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/uo6guvore38kr29y?#YwXpE\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（四）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/hiiaukxvr2zuz5mb?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%94%EF%BC%89%E3%80%8B\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（五）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/avlc01hrko6yvr26?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E5%85%AD%EF%BC%89%E3%80%8B\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（六）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/ybo3xo4kloaqc1xq?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%83%EF%BC%89%E3%80%8B\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（七）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/td2t5cvohdedb878?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E5%85%AB%EF%BC%89%E3%80%8B\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（八）\u003c\/a\u003e\u003cbr\u003e\n\u003ca href=\u0022https:\/\/www.yuque.com\/lilac-2hqvv\/xdwlsg\/nwqez8c4hm5hri8c?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B9%9D%EF%BC%89%E3%80%8B\u0022 target=\u0022_blank\u0022\u003eUnidbg 的基本使用（九）\u003c\/a\u003e\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/alex0rd.github.io\/posts\/2025m1d7h22m24s55\/","author":{"@type":"Person","name":""},"copyrightYear":"2025","dateCreated":"2025-01-07T22:24:55\u002b08:00","datePublished":"2025-01-07T22:24:55\u002b08:00","dateModified":"2025-01-07T22:24:55\u002b08:00","keywords":["笔记","Unidbg"],"mainEntityOfPage":"true","wordCount":"3097"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PEDMYR1V0K"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PEDMYR1V0K")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Owl</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Blog</p></a><a href=/categories/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Categories</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Tags</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400" style=margin-right:5px><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Blog</p></a></li><li class=mt-1><a href=/categories/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Categories</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Tags</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Unidbg补环境之补JNI环境</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-01-07T22:24:55+08:00>7 January 2025</time><span class="px-2 text-primary-500">&#183;</span><span>3097 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=" Author" src=/author_hu12187368777058990913.jpg><div class=place-self-center><div class="text-sm text-neutral-700 dark:text-neutral-400">关于我的二三事</div><div class="text-2xl sm:text-lg"></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#1-形式处理>1. 形式处理</a><ul><li><a href=#11-基本数据类型处理>1.1 基本数据类型处理</a></li><li><a href=#12-字符串基本类型包装类数组>1.2 字符串&基本类型包装类&数组</a><ul><li><a href=#1-字符串>1. 字符串</a></li><li><a href=#2-基本类型的包装类>2. 基本类型的包装类</a></li><li><a href=#3-基本类型数组>3. 基本类型数组</a></li><li><a href=#4--对象数组>4 . 对象数组</a></li><li><a href=#5-list>5. List</a></li></ul></li><li><a href=#13--jdk-标准库>1.3 JDK 标准库</a><ul><li><a href=#1-hashmap>1. HashMap</a></li><li><a href=#2-inputstream>2. InputStream</a></li><li><a href=#5-object类型>5. Object类型</a></li></ul></li><li><a href=#14-android-framework-类库>1.4 Android FrameWork 类库</a><ul><li><a href=#例一>例一</a></li><li><a href=#例二>例二</a></li></ul></li></ul></li><li><a href=#2-内容处理>2. 内容处理</a><ul><li><a href=#21-数据获取>2.1 数据获取</a><ul><li><a href=#方法一理解代码>方法一：理解代码</a></li><li><a href=#方法二adb命令>方法二：adb命令</a></li><li><a href=#方法三自写demo获取>方法三：自写demo获取</a></li><li><a href=#方法四frida-hookcall>方法四：frida hook&amp;call</a></li><li><a href=#方法五trace>方法五：trace</a></li></ul></li><li><a href=#22-代码逻辑>2.2 代码逻辑</a><ul><li><a href=#处理一jdk第三方库代码>处理一：JDK/第三方库代码</a></li><li><a href=#处理二自身代码>处理二：自身代码</a></li><li><a href=#处理三android-framework类库>处理三：Android FrameWork类库</a></li><li><a href=#处理四处理不了或很麻烦的代码>处理四：处理不了或很麻烦的代码</a></li></ul></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#1-形式处理>1. 形式处理</a><ul><li><a href=#11-基本数据类型处理>1.1 基本数据类型处理</a></li><li><a href=#12-字符串基本类型包装类数组>1.2 字符串&基本类型包装类&数组</a><ul><li><a href=#1-字符串>1. 字符串</a></li><li><a href=#2-基本类型的包装类>2. 基本类型的包装类</a></li><li><a href=#3-基本类型数组>3. 基本类型数组</a></li><li><a href=#4--对象数组>4 . 对象数组</a></li><li><a href=#5-list>5. List</a></li></ul></li><li><a href=#13--jdk-标准库>1.3 JDK 标准库</a><ul><li><a href=#1-hashmap>1. HashMap</a></li><li><a href=#2-inputstream>2. InputStream</a></li><li><a href=#5-object类型>5. Object类型</a></li></ul></li><li><a href=#14-android-framework-类库>1.4 Android FrameWork 类库</a><ul><li><a href=#例一>例一</a></li><li><a href=#例二>例二</a></li></ul></li></ul></li><li><a href=#2-内容处理>2. 内容处理</a><ul><li><a href=#21-数据获取>2.1 数据获取</a><ul><li><a href=#方法一理解代码>方法一：理解代码</a></li><li><a href=#方法二adb命令>方法二：adb命令</a></li><li><a href=#方法三自写demo获取>方法三：自写demo获取</a></li><li><a href=#方法四frida-hookcall>方法四：frida hook&amp;call</a></li><li><a href=#方法五trace>方法五：trace</a></li></ul></li><li><a href=#22-代码逻辑>2.2 代码逻辑</a><ul><li><a href=#处理一jdk第三方库代码>处理一：JDK/第三方库代码</a></li><li><a href=#处理二自身代码>处理二：自身代码</a></li><li><a href=#处理三android-framework类库>处理三：Android FrameWork类库</a></li><li><a href=#处理四处理不了或很麻烦的代码>处理四：处理不了或很麻烦的代码</a></li></ul></li></ul></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><blockquote><p>主要是对龙哥Unidbg教程学习的笔记<br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/bmf8lm68ffvhrfu0?#QGrRF target=_blank>Unidbg 的基本使用（三）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/uo6guvore38kr29y?#YwXpE target=_blank>Unidbg 的基本使用（四）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/hiiaukxvr2zuz5mb?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%94%EF%BC%89%E3%80%8B target=_blank>Unidbg 的基本使用（五）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/avlc01hrko6yvr26?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E5%85%AD%EF%BC%89%E3%80%8B target=_blank>Unidbg 的基本使用（六）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/ybo3xo4kloaqc1xq?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%83%EF%BC%89%E3%80%8B target=_blank>Unidbg 的基本使用（七）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/td2t5cvohdedb878?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E5%85%AB%EF%BC%89%E3%80%8B target=_blank>Unidbg 的基本使用（八）</a><br><a href=https://www.yuque.com/lilac-2hqvv/xdwlsg/nwqez8c4hm5hri8c?#%20%E3%80%8AUnidbg%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B9%9D%EF%BC%89%E3%80%8B target=_blank>Unidbg 的基本使用（九）</a></p></blockquote><h2 class="relative group">1. 形式处理<div id=1-%E5%BD%A2%E5%BC%8F%E5%A4%84%E7%90%86 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%E5%BD%A2%E5%BC%8F%E5%A4%84%E7%90%86 aria-label=Anchor>#</a></span></h2><p>也就是对数据的包装，在值传递过程种可能会遇见这类问题。</p><ul><li>基本类型直接传递</li><li>字符串、字节数组等基本对象直接传递，其内部会做封装，也可以自己调用<code>new StringObject(vm, str)</code>、<code>new ByteArray(vm, value)</code>等。</li><li>JDK 标准库对象，如 HashMap、JSONObject 等，使用<code>ProxyDvmObject.createObject(vm, value)</code>处理。</li><li>非 JDK 标准库对象，如 Android Context、SharedPreference 等，使用<code>vm.resolveClass(vm，className).newObject(value)</code>处理</li></ul><h3 class="relative group">1.1 基本数据类型处理<div id=11-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86 aria-label=Anchor>#</a></span></h3><p>基本数据类型，即：byte、short、int、long、double、float、boolean、char。他们直接传递即可。但<strong>Long类型必须显示声明，即在整数后面加L，以供 Unidbg 识别和处理。</strong></p><h3 class="relative group">1.2 字符串&基本类型包装类&数组<div id=12-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%8C%85%E8%A3%85%E7%B1%BB%E6%95%B0%E7%BB%84 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%8C%85%E8%A3%85%E7%B1%BB%E6%95%B0%E7%BB%84 aria-label=Anchor>#</a></span></h3><p>字符串、基本类型的包装类、、基本类型数组、对象类型数组等。</p><h4 class="relative group">1. 字符串<div id=1-%E5%AD%97%E7%AC%A6%E4%B8%B2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%E5%AD%97%E7%AC%A6%E4%B8%B2 aria-label=Anchor>#</a></span></h4><p>对于String类型的数据，需要将其处理为StringObject</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: cn/xiaochuankeji/tieba/AppController-&gt;getPackageName()Ljava/lang/String;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:416)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.izuiyou.NetWork.callObjectMethodV(NetWork.java:86)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StringObject</span><span class=w> </span><span class=n>stringObject1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>StringObject</span><span class=p>)</span><span class=w> </span><span class=n>ProxyDvmObject</span><span class=p>.</span><span class=na>createObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StringObject</span><span class=w> </span><span class=n>stringObject2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>);</span><span class=w> </span><span class=c1>// 更推荐</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">2. 基本类型的包装类<div id=2-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%85%E8%A3%85%E7%B1%BB class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%85%E8%A3%85%E7%B1%BB aria-label=Anchor>#</a></span></h4><p>Unidbg中对部分包装类进行处理，在com.github.unidbg.linux.android.dvm.wrapper文件夹下：DvmBoolean.java、DvmInteger.java、DvmLong.java
其中都提供了<code>valueOf</code>方法做包装
例如对Integer处理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: java/lang/Integer-&gt;&lt;init&gt;(I)V</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.newObjectV(AbstractJni.java:789)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo5.MeiTuan.newObjectV(MeiTuan.java:557)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/lang/Integer-&gt;&lt;init&gt;(I)V&#34;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getIntArg</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>DvmInteger</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">3. 基本类型数组<div id=3-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%95%B0%E7%BB%84 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%95%B0%E7%BB%84 aria-label=Anchor>#</a></span></h4><p>有两种处理方式：
一、<code>com.github.unidbg.linux.android.dvm.array</code>包下有对各种基本类型数组的表示和处理。
JNI数组类型Unidbg中对应关系</p><table><thead><tr><th>JNI</th><th>Unidbg</th></tr></thead><tbody><tr><td>jarray</td><td>BaseArray</td></tr><tr><td>jobjectArray</td><td>ArrayObject</td></tr><tr><td>jbyteArray</td><td>ByteArray</td></tr><tr><td>jdoubleArray</td><td>DoubleArray</td></tr><tr><td>jfloatArray</td><td>FloatArray</td></tr><tr><td>jIntArray</td><td>IntArray</td></tr><tr><td>jshotArray</td><td>ShortArray</td></tr><tr><td>二、使用<code>ProxyDvmObject.createObject</code>。其内部会做对应的处理</td><td></td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>short</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ShortArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>short</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>int</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IntArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FloatArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>double</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DoubleArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>double</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>例如对[B，即字节数组进行处理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: java/net/NetworkInterface-&gt;getHardwareAddress()[B</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:921)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo14.SimpleSign.callObjectMethod(SimpleSign.java:177)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/net/NetworkInterface-&gt;getHardwareAddress()[B&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=p>{</span><span class=n>0x64</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=n>0xBC</span><span class=p>,</span><span class=w> </span><span class=n>0x0C</span><span class=p>,</span><span class=w> </span><span class=n>0x65</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=n>0xAA</span><span class=p>,</span><span class=w> </span><span class=n>0x1E</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// return (ByteArray) ProxyDvmObject.createObject(vm, addr) //也可以</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>addr</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">4 . 对象数组<div id=4--%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4--%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84 aria-label=Anchor>#</a></span></h4><p>有两种处理方式：一种方式是通过<code>ProxyDvmObject.createObject</code>，其最终还是通过<code>ArrayObject</code>来处理。另一种方式是直接使用<code>ArrayObject</code>
在 Unidbg 中，对象数组通过<code>ArrayObject</code>表示，而且还为字符串数组提供了一个方便的处理函数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>ArrayObject</span><span class=w> </span><span class=nf>newStringArray</span><span class=p>(</span><span class=n>VM</span><span class=w> </span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>...</span><span class=w> </span><span class=n>strings</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StringObject</span><span class=o>[]</span><span class=w> </span><span class=n>objects</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=o>[</span><span class=n>strings</span><span class=p>.</span><span class=na>length</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>strings</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strings</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>str</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>objects</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayObject</span><span class=p>(</span><span class=n>objects</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>使用它可以方便的构造字符串数组：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: android/os/Build-&gt;SUPPORTED_ABIS:[Ljava/lang/String;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo5.MeiTuan.getStaticObjectField(MeiTuan.java:629)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/os/Build-&gt;SUPPORTED_ABIS:[Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ArrayObject</span><span class=p>.</span><span class=na>newStringArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=s>&#34;arm64-v8a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;armeabi-v7a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;armeabi&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>也可以使用<code>ProxyDvmObject.createObject</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>case</span><span class=w> </span><span class=s>&#34;android/os/Build-&gt;SUPPORTED_ABIS:[Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>abis</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=p>{</span><span class=s>&#34;arm64-v8a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;armeabi-v7a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;armeabi&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ProxyDvmObject</span><span class=p>.</span><span class=na>createObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>abis</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">5. List<div id=5-list class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-list aria-label=Anchor>#</a></span></h4><p>使用<code>ArrayListObject</code>, 参考：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: android/hardware/SensorManager-&gt;getSensorList(I)Ljava/util/List;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:416)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo2.Tiny.callObjectMethodV(Tiny.java:334)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/hardware/SensorManager-&gt;getSensorList(I)Ljava/util/List;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DvmObject</span><span class=o>&lt;?&gt;&gt;</span><span class=w> </span><span class=n>SensorList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SensorList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;android/hardware/Sensor&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=n>i</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayListObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>SensorList</span><span class=p>);</span><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 class="relative group">1.3 JDK 标准库<div id=13--jdk-%E6%A0%87%E5%87%86%E5%BA%93 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13--jdk-%E6%A0%87%E5%87%86%E5%BA%93 aria-label=Anchor>#</a></span></h3><p>基本只能使用<code>ProxyDvmObject.createObject</code>来处理了</p><h4 class="relative group">1. HashMap<div id=1-hashmap class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-hashmap aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// java.lang.UnsupportedOperationException: java/util/HashMap-&gt;&lt;init&gt;()V</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.newObject(AbstractJni.java:741)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo4.TBSecurity.newObject(TBSecurity.java:392)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/util/HashMap-&gt;&lt;init&gt;()V&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ProxyDvmObject</span><span class=p>.</span><span class=na>createObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">2. InputStream<div id=2-inputstream class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-inputstream aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: java/util/zip/ZipFile-&gt;getInputStream(Ljava/util/zip/ZipEntry;)Ljava/io/InputStream;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:416)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo7.TDJNI.callObjectMethodV(TDJNI.java:625)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/util/zip/ZipFile-&gt;getInputStream(Ljava/util/zip/ZipEntry;)Ljava/io/InputStream;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ZipFile</span><span class=w> </span><span class=n>zipFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ZipFile</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ProxyDvmObject</span><span class=p>.</span><span class=na>createObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>zipFile</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>((</span><span class=n>ZipEntry</span><span class=p>)</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">5. Object类型<div id=5-object%E7%B1%BB%E5%9E%8B class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-object%E7%B1%BB%E5%9E%8B aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: java/util/Map-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:922)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.Bili.NativeLibrary.callObjectMethod(NativeLibrary.java:88)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/util/Map-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Map</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>varArg</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>varArg</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>1</span><span class=p>).</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ProxyDvmObject</span><span class=p>.</span><span class=na>createObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 class="relative group">1.4 Android FrameWork 类库<div id=14-android-framework-%E7%B1%BB%E5%BA%93 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-android-framework-%E7%B1%BB%E5%BA%93 aria-label=Anchor>#</a></span></h3><p>对于 Android FrameWork 类库中的对象和类，使用<code>resolveClass</code>创建对应的<code>DvmClass</code>和<code>DvmObject</code>比较好。在 AbstrctJNI 中可以看到大量的例子。</p><h4 class="relative group">例一<div id=%E4%BE%8B%E4%B8%80 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BE%8B%E4%B8%80 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: android/telephony/FtTelephonyAdapter-&gt;getFtTelephony(Landroid/content/Context;)Landroid/telephony/FtTelephony;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:503)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo7.TDJNI.callStaticObjectMethodV(TDJNI.java:763)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/telephony/FtTelephonyAdapter-&gt;getFtTelephony(Landroid/content/Context;)Landroid/telephony/FtTelephony;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;android/telephony/FtTelephony&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">例二<div id=%E4%BE%8B%E4%BA%8C class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BE%8B%E4%BA%8C aria-label=Anchor>#</a></span></h4><p><code>Class.forName(className)</code>用于加载类，我们不确定所加载的类是样本自定义的类、Android 框架层类库，还是 JDK 中的标准类库，这种情况里使用<code>resolveClass</code>是好办法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//java.lang.UnsupportedOperationException: java/lang/Class-&gt;forName(Ljava/lang/String;)Ljava/lang/Class;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:503)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo7.TDJNI.callStaticObjectMethodV(TDJNI.java:763)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;java/lang/Class-&gt;forName(Ljava/lang/String;)Ljava/lang/Class;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Class-&gt;forName:&#34;</span><span class=o>+</span><span class=n>className</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=n>className</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>```###</span><span class=w> </span><span class=n>例三</span><span class=err>：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>这里要初始化</span><span class=err>`</span><span class=n>IntentFilter</span><span class=err>`，</span><span class=n>同样的</span><span class=w> </span><span class=n>Android</span><span class=w> </span><span class=n>框架层的类库</span><span class=err>，</span><span class=n>只能做占位处理</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>```</span><span class=n>Java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//java.lang.UnsupportedOperationException: android/content/IntentFilter-&gt;&lt;init&gt;(Ljava/lang/String;)V</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.github.unidbg.linux.android.dvm.AbstractJni.newObjectV(AbstractJni.java:791)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//	at com.demo7.TDJNI.newObjectV(TDJNI.java:826)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/content/IntentFilter-&gt;&lt;init&gt;(Ljava/lang/String;)V&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>intent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;IntentFilter:&#34;</span><span class=o>+</span><span class=n>intent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;android/content/IntentFilter&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=n>intent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 class="relative group">2. 内容处理<div id=2-%E5%86%85%E5%AE%B9%E5%A4%84%E7%90%86 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%E5%86%85%E5%AE%B9%E5%A4%84%E7%90%86 aria-label=Anchor>#</a></span></h2><h3 class="relative group">2.1 数据获取<div id=21-%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96 aria-label=Anchor>#</a></span></h3><h4 class="relative group">方法一：理解代码<div id=%E6%96%B9%E6%B3%95%E4%B8%80%E7%90%86%E8%A7%A3%E4%BB%A3%E7%A0%81 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%96%B9%E6%B3%95%E4%B8%80%E7%90%86%E8%A7%A3%E4%BB%A3%E7%A0%81 aria-label=Anchor>#</a></span></h4><p>理解方法、字段的语义，返回合适的值。
例如：isVpn函数，是检测VPN的函数，通过google了解函数含义，返回合适的值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// 检测 VPN，通过 tun0/ppp0。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isVPN()Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=s>&#34;0&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">方法二：adb命令<div id=%E6%96%B9%E6%B3%95%E4%BA%8Cadb%E5%91%BD%E4%BB%A4 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%96%B9%E6%B3%95%E4%BA%8Cadb%E5%91%BD%E4%BB%A4 aria-label=Anchor>#</a></span></h4><p><code>ADB</code>命令
例如：获取屏幕宽高，通过ADB获取信息，然后再返回。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// adb shell wm size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Physical size: 1080x2160</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/view/Display-&gt;getHeight()I&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>2160</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/view/Display-&gt;getWidth()I&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>1080</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">方法三：自写demo获取<div id=%E6%96%B9%E6%B3%95%E4%B8%89%E8%87%AA%E5%86%99demo%E8%8E%B7%E5%8F%96 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%96%B9%E6%B3%95%E4%B8%89%E8%87%AA%E5%86%99demo%E8%8E%B7%E5%8F%96 aria-label=Anchor>#</a></span></h4><p>自写demo，做验证。
例如：获取传感器信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>//SensorManager manager= (SensorManager)getSystemService(SENSOR_SERVICE);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//Sensor accelSensor = manager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//Log.e(&#34;lilac sensor Name&#34;,accelSensor.getName());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// lilac sensor Name: ICM20690</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/hardware/Sensor-&gt;getName()Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Sensor getName:&#34;</span><span class=o>+</span><span class=n>type</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>1</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ICM20690&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UnsupportedOperationException</span><span class=p>(</span><span class=n>signature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">方法四：frida hook&amp;call<div id=%E6%96%B9%E6%B3%95%E5%9B%9Bfrida-hookcall class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%96%B9%E6%B3%95%E5%9B%9Bfrida-hookcall aria-label=Anchor>#</a></span></h4><p>Unidbg 补的执行流在真机上也理应执行过，那么 Frida Spwan 模式 Hook 应该能拦截到这种例如：<code>uiAutomatorClickCount</code>的处理就依赖于 Hook。
frida hook</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=line><span class=cl><span class=nx>Java</span><span class=p>.</span><span class=nx>perform</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>SIUACollector</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;com.meituan.android.common.mtguard.NBridge$SIUACollector&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SIUACollector</span><span class=p>[</span><span class=s2>&#34;uiAutomatorClickCount&#34;</span><span class=p>].</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;uiAutomatorClickCount is called&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>ret</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>uiAutomatorClickCount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;uiAutomatorClickCount ret value is &#39;</span> <span class=o>+</span> <span class=nx>ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// uiAutomatorClickCount ret value is 0
</span></span></span></code></pre></div><p>Unidbg处理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>callIntMethodV</span><span class=p>(</span><span class=n>BaseVM</span><span class=w> </span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>DvmObject</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>dvmObject</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>signature</span><span class=p>,</span><span class=w> </span><span class=n>VaList</span><span class=w> </span><span class=n>vaList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>signature</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;uiAutomatorClickCount()I&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>callIntMethodV</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>dvmObject</span><span class=p>,</span><span class=w> </span><span class=n>signature</span><span class=p>,</span><span class=w> </span><span class=n>vaList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">方法五：trace<div id=%E6%96%B9%E6%B3%95%E4%BA%94trace class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E6%96%B9%E6%B3%95%E4%BA%94trace aria-label=Anchor>#</a></span></h4><p>例如使用r0trace 追踪<code>SIUACollector</code>类里的所有事件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=line><span class=cl><span class=c1>//A. 简易trace单个函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>traceClass</span><span class=p>(</span><span class=s2>&#34;com.meituan.android.common.mtguard.NBridge$SIUACollector&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>在输出日志中可以找到字段的多次赋值过程</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=n>int</span>     <span class=n>level</span> <span class=p>=&gt;</span> <span class=mf>3</span> <span class=p>=&gt;</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl><span class=n>boolean</span>         <span class=n>plugged</span> <span class=p>=&gt;</span> <span class=n>false</span> <span class=p>=&gt;</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=n>int</span>     <span class=n>scale</span> <span class=p>=&gt;</span> <span class=mf>100</span> <span class=p>=&gt;</span> <span class=mf>100</span>
</span></span><span class=line><span class=cl><span class=n>int</span>     <span class=n>status</span> <span class=p>=&gt;</span> <span class=mf>0</span> <span class=p>=&gt;</span> <span class=mf>0</span>
</span></span></code></pre></div><p>trace 是最快的补环境办法。
trace工具：
1. r0tracer
2. JNITrace
3. JTrace</p><h3 class="relative group">2.2 代码逻辑<div id=22-%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91 aria-label=Anchor>#</a></span></h3><h4 class="relative group">处理一：JDK/第三方库代码<div id=%E5%A4%84%E7%90%86%E4%B8%80jdk%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BB%A3%E7%A0%81 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%A4%84%E7%90%86%E4%B8%80jdk%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BB%A3%E7%A0%81 aria-label=Anchor>#</a></span></h4><p>对于 JDK 里包含的类库，可以直接复现其方法逻辑。
比如对 SimpleDateFormat 的操作</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>case</span><span class=w> </span><span class=s>&#34;java/text/SimpleDateFormat-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/util/Locale;)V&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Locale</span><span class=w> </span><span class=n>locale</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Locale</span><span class=p>)</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>1</span><span class=p>).</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>simpleDateFormat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SimpleDateFormat</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span><span class=w> </span><span class=n>locale</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>比如 okhttp3，可以 maven 引入然后正常使用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>case</span><span class=w> </span><span class=s>&#34;okhttp3/Headers-&gt;name(I)Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Headers</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Headers</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=n>vaList</span><span class=p>.</span><span class=na>getIntArg</span><span class=p>(</span><span class=n>0</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;okhttp3/Headers-&gt;value(I)Ljava/lang/String;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Headers</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Headers</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringObject</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>value</span><span class=p>(</span><span class=n>vaList</span><span class=p>.</span><span class=na>getIntArg</span><span class=p>(</span><span class=n>0</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;okio/Buffer-&gt;clone()Lokio/Buffer;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Buffer</span><span class=w> </span><span class=n>buffer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Buffer</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;okio/Buffer&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=n>buffer</span><span class=p>.</span><span class=na>clone</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;okhttp3/Request-&gt;newBuilder()Lokhttp3/Request$Builder;&#34;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Request</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Request</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;okhttp3/Request$Builder&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;okhttp3/Request$Builder-&gt;header(Ljava/lang/String;Ljava/lang/String;)Lokhttp3/Request$Builder;&#34;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Request</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=na>Builder</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>builder</span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>1</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>dvmObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;okhttp3/Request$Builder-&gt;build()Lokhttp3/Request;&#34;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Request</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=na>Builder</span><span class=p>)</span><span class=w> </span><span class=n>dvmObject</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vm</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=s>&#34;okhttp3/Request&#34;</span><span class=p>).</span><span class=na>newObject</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">处理二：自身代码<div id=%E5%A4%84%E7%90%86%E4%BA%8C%E8%87%AA%E8%BA%AB%E4%BB%A3%E7%A0%81 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%A4%84%E7%90%86%E4%BA%8C%E8%87%AA%E8%BA%AB%E4%BB%A3%E7%A0%81 aria-label=Anchor>#</a></span></h4><p>样本自定义的类库，可以在<code>JADX</code>、<code>GDA</code>、<code>JEB</code>等工具中反编译，然后把代码逻辑拷贝到 Unidbg 环境里。有些 Android FrameWork 层的类库也同样可以拷贝过来。
例如Android 的 Base64 工具类，可以直接抠出来</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>case</span><span class=w> </span><span class=s>&#34;android/util/Base64-&gt;decode(Ljava/lang/String;I)[B&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>arg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getIntArg</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArray</span><span class=p>(</span><span class=n>vm</span><span class=p>,</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>decode</span><span class=p>(</span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=n>flag</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">处理三：Android FrameWork类库<div id=%E5%A4%84%E7%90%86%E4%B8%89android-framework%E7%B1%BB%E5%BA%93 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%A4%84%E7%90%86%E4%B8%89android-framework%E7%B1%BB%E5%BA%93 aria-label=Anchor>#</a></span></h4><p>有些 Android FrameWork 类库，使用频率很高，JDK 里又没有其对应，我们就需要复写其语义，实现其基本功能。
比如 SharedPreferences，我们最好写一个小的 demo，实现 Android 中对 SP 的创建、打开、读取、修改、保存这些基本功能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson.JSON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson.JSONObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SharedPreferences</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>File</span><span class=w> </span><span class=n>mFile</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SharedPreferences</span><span class=p>(</span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>loadFromDisk</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>loadFromDisk</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>mFile</span><span class=p>.</span><span class=na>exists</span><span class=p>()</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>mFile</span><span class=p>.</span><span class=na>canRead</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Attempt to read preferences file &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>mFile</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; without permission&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BufferedInputStream</span><span class=w> </span><span class=n>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BufferedInputStream</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FileInputStream</span><span class=p>(</span><span class=n>mFile</span><span class=p>),</span><span class=w> </span><span class=n>16</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1024</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>readSP</span><span class=p>(</span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getSharedPreferences:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getString</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>defValue</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=n>jsonObject</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>defValue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>putString</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>value</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>readSP</span><span class=p>(</span><span class=n>InputStream</span><span class=w> </span><span class=n>in</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>char</span><span class=o>[]</span><span class=w> </span><span class=n>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>char</span><span class=o>[</span><span class=n>16</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1024</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStreamReader</span><span class=w> </span><span class=n>input</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InputStreamReader</span><span class=p>(</span><span class=n>in</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=n>input</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>text</span><span class=w> </span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=p>(</span><span class=n>text</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>以及根据样本所操作的属性和方法，构建对应的类去描述它</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AccessibilityServiceInfo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 指定您希望服务处理的无障碍事件所属的应用的软件包名称。如果省略此参数，则无障碍服务会被视为可用于处理任何应用的无障碍事件。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 即当前无障碍服务作用于哪些app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>packageNames</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 当前无障碍服务的名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 当前无障碍服务所属App的标签名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=n>label</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 当前无障碍服务所属App的包名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>packageName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AccessibilityServiceInfo</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>packageName</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=n>label</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>packageNames</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>packageName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>packageName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>label</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>packageNames</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>packageNames</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 class="relative group">处理四：处理不了或很麻烦的代码<div id=%E5%A4%84%E7%90%86%E5%9B%9B%E5%A4%84%E7%90%86%E4%B8%8D%E4%BA%86%E6%88%96%E5%BE%88%E9%BA%BB%E7%83%A6%E7%9A%84%E4%BB%A3%E7%A0%81 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%A4%84%E7%90%86%E5%9B%9B%E5%A4%84%E7%90%86%E4%B8%8D%E4%BA%86%E6%88%96%E5%BE%88%E9%BA%BB%E7%83%A6%E7%9A%84%E4%BB%A3%E7%A0%81 aria-label=Anchor>#</a></span></h4><p>如果其他方法处理不了或者很麻烦，我们会将方法调用”降级“为简单的数据返回或占位或返回 null，这么做有风险，但总比没法继续执行好。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=k>case</span><span class=w> </span><span class=s>&#34;android/bluetooth/BluetoothAdapter-&gt;getDefaultAdapter()Landroid/bluetooth/BluetoothAdapter;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>dvmClass</span><span class=p>.</span><span class=na>newObject</span><span class=p>(</span><span class=n>signature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/telephony/SubscriptionManager-&gt;from(Landroid/content/Context;)Landroid/telephony/SubscriptionManager;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>dvmClass</span><span class=p>.</span><span class=na>newObject</span><span class=p>(</span><span class=n>signature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/net/Uri-&gt;parse(Ljava/lang/String;)Landroid/net/Uri;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaList</span><span class=p>.</span><span class=na>getObjectArg</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getValue</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;content://telephony/siminfo&#34;</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>dvmClass</span><span class=p>.</span><span class=na>newObject</span><span class=p>(</span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>例如</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// 获取packageName信息，后续对比是否有多开助手类app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// https://blog.csdn.net/qq_32227681/article/details/110563688</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>case</span><span class=w> </span><span class=s>&#34;android/content/pm/PackageManager-&gt;getInstalledPackages(I)Ljava/util/List;&#34;</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></div></div><script>var oid="views_posts/2025m1d7h22m24s55.md",oid_likes="likes_posts/2025m1d7h22m24s55.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span></span><span><a class="flex text-right group ml-3" href=/posts/2025m1d8h3m37s35/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Unidbg补环境之处理文件访问</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-01-08T03:37:35+08:00>8 January 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://alex0rd.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>